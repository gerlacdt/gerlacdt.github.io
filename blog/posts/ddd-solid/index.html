<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>DDD and SOLID: A refactoring story | Daniel's programming rants</title><meta name=keywords content="programming,softwareengineering,ddd,solid"><meta name=description content="TL;DR  Command-Query Separation Extract Use Cases (Clean/Hexagonal Architecture) Domain Events (with Eventhandlers and Composite Pattern) Cross-Cutting Concerns (with Decorator Pattern)  Many backend applications end up as a big ball of mud where small changes ripple through the whole codebase. The root causes are high coupling and low cohesion. The best remedies against those are Domain Driven Design (DDD) and the SOLID principles which are well-known, but often wrongly applied."><meta name=author content="Daniel Gerlach"><link rel=canonical href=https://gerlacdt.github.io/blog/posts/ddd-solid/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.min.48a18943c2fc15c38a372b8dde1f5e5dc0bc64fa6cb90f5a817d2f8c76b7f3ae.css integrity="sha256-SKGJQ8L8FcOKNyuN3h9eXcC8ZPpsuQ9agX0vjHa3864=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/blog/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://gerlacdt.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://gerlacdt.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://gerlacdt.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://gerlacdt.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://gerlacdt.github.io/blog/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-4BE9J0ZRDL"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-4BE9J0ZRDL",{anonymize_ip:!1})}</script><meta property="og:title" content="DDD and SOLID: A refactoring story"><meta property="og:description" content="TL;DR  Command-Query Separation Extract Use Cases (Clean/Hexagonal Architecture) Domain Events (with Eventhandlers and Composite Pattern) Cross-Cutting Concerns (with Decorator Pattern)  Many backend applications end up as a big ball of mud where small changes ripple through the whole codebase. The root causes are high coupling and low cohesion. The best remedies against those are Domain Driven Design (DDD) and the SOLID principles which are well-known, but often wrongly applied."><meta property="og:type" content="article"><meta property="og:url" content="https://gerlacdt.github.io/blog/posts/ddd-solid/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-19T08:00:00+01:00"><meta property="article:modified_time" content="2023-07-19T08:00:00+01:00"><meta property="og:site_name" content="Daniel's programming rants"><meta name=twitter:card content="summary"><meta name=twitter:title content="DDD and SOLID: A refactoring story"><meta name=twitter:description content="TL;DR  Command-Query Separation Extract Use Cases (Clean/Hexagonal Architecture) Domain Events (with Eventhandlers and Composite Pattern) Cross-Cutting Concerns (with Decorator Pattern)  Many backend applications end up as a big ball of mud where small changes ripple through the whole codebase. The root causes are high coupling and low cohesion. The best remedies against those are Domain Driven Design (DDD) and the SOLID principles which are well-known, but often wrongly applied."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://gerlacdt.github.io/blog/posts/"},{"@type":"ListItem","position":3,"name":"DDD and SOLID: A refactoring story","item":"https://gerlacdt.github.io/blog/posts/ddd-solid/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"DDD and SOLID: A refactoring story","name":"DDD and SOLID: A refactoring story","description":"TL;DR  Command-Query Separation Extract Use Cases (Clean/Hexagonal Architecture) Domain Events (with Eventhandlers and Composite Pattern) Cross-Cutting Concerns (with Decorator Pattern)  Many backend applications end up as a big ball of mud where small changes ripple through the whole codebase. The root causes are high coupling and low cohesion. The best remedies against those are Domain Driven Design (DDD) and the SOLID principles which are well-known, but often wrongly applied.","keywords":["programming","softwareengineering","ddd","solid"],"articleBody":"TL;DR  Command-Query Separation Extract Use Cases (Clean/Hexagonal Architecture) Domain Events (with Eventhandlers and Composite Pattern) Cross-Cutting Concerns (with Decorator Pattern)  Many backend applications end up as a big ball of mud where small changes ripple through the whole codebase. The root causes are high coupling and low cohesion. The best remedies against those are Domain Driven Design (DDD) and the SOLID principles which are well-known, but often wrongly applied.\nEven if teams think they practice DDD, they mostly use transaction scripts with an anemic domain model. Services containing these transaction scripts evolve into god classes with thousand lines of code and dozen of dependencies. Such code is hard to test, hard to maintain and hard to comprehend. Does the following code snippet look familiar to you?\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  // BAD CODE!!!  public class OrderService {  private OrderRepository orderRepository; private CardService cardService; private DiscountCalculatorService discountCalculatorService; private CustomerService customerService; private EmailService emailService; private ShippingService shippingService;  // many more dependencies...  public Order createOrder(params: OrderParms) {} public Order getOrder(orderId: UUID) {} public ListOrder filterOrdersByDate(id: UserId, range: DateRange) public void updateOrder(id: OrderId) {} public void addToCard(id: OrderId) {} public void addDiscount(id: OrderId) {} public void addDiscountForPremiumCustomer(id: OrderId) {} public void shipOrder(id: OrderId) {} public OrderStatus getOrderStatus(id: OrderId) {} public void cancelOrder(id: OrderId) {} public ListOrder getCanceledOrders(id: UserId)  // many more methods... }   Surrounding all behaviour around one domain object in a single class is an OOP anti-pattern and leads to unsustainable code. In this article, we’ll refactor the code above into a maintainable and decoupled solution with the help of DDD and the SOLID principles. Let’s first find out what SOLID principles are violated and why.\nSingle-Responsibility Principle (SRP)  A class should only have one reason to change.\n The OrderService has many reasons to change. For example, it must be adopted when there a changes for the discount calculation logic, the shipping logic, the order creation logic etc.. Worse yet, due to the numerous dependencies the OrderService suffers from low cohesion which also causes the class to be prone to unrelated changes.\nOpen-Closed Principle  A class should be open for extension but closed for modification.\n The OrderService’s business logic is impossible to adapt without touching the existing code. This makes changes error-prone and is a violation of the Open-Closed Principle. I know it’s hard to imagine how to change behaviour without touching the code but we’ll see later what is meant by that and how to resolve the problem.\nInterface-Segregation Principle  Clients should not be forced to depend upon interfaces that they do not use.\n A consumer of OrderService is overwhelmed by all the methods provided. If a consumer only wants to use a single method like createOrder(), he must depend on the complete OrderService interface. Such big interfaces lead to testing nightmares because in order to create a viable fake, one must implement all methods even if only one is needed.\nCohesion and Coupling The SOLID violations above lead to low cohesion and high coupling. As a result, simple changes will ripple through the whole codebase and are also error-prone because we have to modify and touch existing code. This leads to high maintenance effort. In the next paragraphs, we refactor the OrderService step-by-step and fix the above issues.\nRefactorings Command-Query Separation Collecting all functionality around one domain class is bad practice. In order to improve and slim down the big OrderService, we will split the functionality into commands and queries. The Command-Query Separation Principle from Bertrand Meyer classifies functions into two types:\n  A command performs side-effects but does not return a value.\n  A query returns a value but has no side-effects.\n  The principle helps to write intention-revealing interfaces since readers will be able to detect the type of a function by just looking at its declaration. Thus the code is easier to understand. Don’t confuse it with the similar sounding architecture pattern CQRS.\nThe restructured OrderService will be split up into two classes:\nThe god class is stripped down to half its size but it still violates the Single-Responsibility and Interface-Segregation Principle. Both classes, OrderCommandService and OrderQueryService, need to be changed because of multiple reasons and a consumer would still depend on methods which are potentially not needed.\nExtract Use Cases To fix the SRP and ISP violations, we extract every single method of the OrderCommandService and OrderQueryService into its own Use-Case interface. Use-Cases are a concept from Clean- and Hexagonal Architecture. Maybe it sounds over-engineered but for an ever-growing enterprise application it will soon pay off. The new consistent structure makes it obvious for developers where to add new functionality, keeps the code extensible and testable, and prevents god classes.\nDomain Events The Use-Case classes became smaller and more structured now, but sometimes even a single Use-Case can grow too big, especially when there are a lot of related side-effects involved:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  public class CreateOrderUseCase {  public Order createOrder(params: OrderParams) {  // register order   // charge customer   // send confirmation email   // notify warehouse   // more logic and side-effects ...   // ... }   A great way to extract such side-effects is to publish DomainEvents which are processed by EventHandlers. With a generic Interface EventHandler, it is possible to register multiple EventHandlers for a single DomainEvent, whereby each handler has its own responsibility. For example:\n register order in system charge customer account send a confirmation email notify warehouse to prepare order for shipping  By moving the side-effect logic into corresponding EventHandlers, the size of the CreateOrderUseCase class will be reduced drastically. Additionally, testability also improves because EventHandlers can be tested in isolation.\nThe CreatedOrderUseCase will depend on the EventHandler interface. At runtime the CompositeOrderCreatedEventHandler will be injected which calls all EventHandlers for the OrderCreatedEvent. The class diagram:\nThe Use-Case logic does not look like a Transaction Script any longer and feels like clean OOP:\n1 2 3 4 5  // the generic interface public interface EventHandlerTEvent {   void handle(TEvent event); }   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32  @Service public class CreateOrderUseCase implements ICreateOrderUseCase {   // an \"composite\" EventHandler which executes multiple EventHandlers  private final EventHandlerOrderCreatedEvent eventHandler;   private final OrderRepository orderRepository;   @Autowired  // Spring needs a @Qualifier in order to locate the right EventHandler  // because there are multiple EventHandler implementations for the same interface  public CreateOrderUseCase(  @Qualifier(\"compositeOrderCreatedEventHandler\")  EventHandlerOrderCreatedEvent eventHandler,  OrderRepository orderRepository) {  this.eventHandler = eventHandler;  this.orderRepository = orderRepository;  }   @Override  public Order createOrder(OrderParams params) {  String id = \"randomOrderId\"; // simplified for the example  Order order = new Order(id, params.getItemId(), params.getAmount());  orderRepository.save(order);   // side-effects are hidden inside the EventHandler  // all side-effects are processed with one call!  eventHandler.handle(new OrderCreatedEvent(order));   return order;  } }   The grouping of all EventHandlers for one specific DomainEvent is done via the Composite Pattern:\n1 2 3 4 5 6 7 8 9  // single EventHandler  @Component public class ConfirmEmailHandler implements EventHandlerOrderCreatedEvent {  @Override  public void handle(OrderCreatedEvent orderCreatedEvent) {  System.out.println(\"[EVENT] sent confirmation email to customer\");  } }   1 2 3 4 5 6 7 8 9  // single EventHandler  @Component public class NotifyWarehouseHandler implements EventHandlerOrderCreatedEvent {  @Override  public void handle(OrderCreatedEvent orderCreatedEvent) {  System.out.println(\"[EVENT] notify warehouse of new order\");  } }   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  // single EventHandler  @Component public class ChargeCustomerHandler implements EventHandlerOrderCreatedEvent {  private final PaymentGateway paymentGateway;   @Autowired  public ChargeCustomerHandler(PaymentGateway paymentGateway) {  this.paymentGateway = paymentGateway;  }   @Override  public void handle(OrderCreatedEvent orderCreatedEvent) {  this.paymentGateway.chargeCustomer(orderCreatedEvent.getOrder());  } }   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  // composite EventHandler includes all EventHandlers  @Service @Qualifier(\"compositeOrderCreatedEventHandler\") public class CompositeOrderCreatedEventHandler implements EventHandlerOrderCreatedEvent {   // all available event handlers without a @Qualifier will be injected automatically  private final ListEventHandlerOrderCreatedEvent eventHandlers;   @Autowired  public CompositeOrderCreatedEventHandler(ListEventHandlerOrderCreatedEvent eventHandlers) {  this.eventHandlers = eventHandlers;  }   @Override  public void handle(OrderCreatedEvent orderCreatedEvent) {   // call all registered event handler for OrderCreatedEvent  for (EventHandlerOrderCreatedEvent handler : this.eventHandlers) {  handler.handle(orderCreatedEvent);  }  } }   The restructuring enables us to add new functionality without modifying existing code. Therefore we comply with the Open-Closed principle! If we want to add a new side-effect, we only have to add a new implementation of EventHandler. It is not necessary to touch the original CreateOrderUseCase class anymore.\nSome intrigued readers may wonder how to test this setup. Spring Boot offers an easy way to replace the EventHandlers with Test Doubles:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  @TestConfiguration // this will take precedence in tests public class FakeConfig {   // example how to manually setup the EventHandlers for tests   @Bean  @Qualifier(\"compositeOrderCreatedEventHandler\")  public EventHandlerOrderCreatedEvent eventHandler(PaymentGateway paymentGateway) {  var warehouseHandler = new NotifyWarehouseHandler();  var chargeCustomerHandler = new ChargeCustomerHandler(paymentGateway);  ListEventHandlerOrderCreatedEvent handlers =  List.of(warehouseHandler, chargeCustomerHandler);  var compositeHandler = new CompositeOrderCreatedEventHandler(handlers);  return compositeHandler;  } }   1 2 3 4 5 6 7 8 9 10 11  @SpringBootTest @Import(FakeConfig.class) // replace dependencies with test doubles public class CreateOrderUseCaseFakeTest {   @Autowired CreateOrderUseCase sut;   @Test  public void createOrderTest_validInput_ok() {  // ...  } }   Cross-Cutting Concerns We are able to add new functionality without touching existing code but we are restricted to prescribed Domain Events. What if we want to add general functionality like Cross Cutting Concerns:\n Logging Transactions Metrics (e.g. duration profiling)  The naive approach would be to add the new code into the Use-Case class itself but we already know that this violates the Open-Closed Principle. Maybe there is another approach? And yes there is. We can utilize the Decorator Pattern to enrich the existing Use-Case with logging, transactional or profiling behaviour. The following example shows decorators wrapping the CreateOrderUseCase with logging and profiling:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28  // Duration Decorator // Measures the duration of the UseCase method  public class DurationCreateOrderUseCase implements ICreateOrderUseCase {   private static Logger log = LoggerFactory.getLogger(DurationCreateOrderUseCase.class);   // the original UseCase  private ICreateOrderUseCase inner;   public DurationCreateOrderUseCase(ICreateOrderUseCase inner) {  this.inner = inner;  }   @Override  public Order createOrder(OrderParams params) {  var start = System.nanoTime();   // execute original logic  var order = this.inner.createOrder(params);   var end = System.nanoTime();  var durationMicros = (end - start) / 1000;  log.info(\"[DURATION] createOrder() = {} micro seconds\", durationMicros);   return order;  } }   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  // Logging Decorator // logs the input parameter of the UseCase method  public class LoggingCreateOrderUseCase implements ICreateOrderUseCase {   private static Logger log = LoggerFactory.getLogger(LoggingCreateOrderUseCase.class);   private ICreateOrderUseCase inner;   public LoggingCreateOrderUseCase(ICreateOrderUseCase inner) {  this.inner = inner;  }   @Override  public Order createOrder(OrderParams params) {  // log params  log.info(\"[LoggingDecorator] function params: {}\", params);   // executes original logic  return inner.createOrder(params);  } }   The next step is to make the decorated UseCase available as a Spring Bean. Because we have multiple implementations of the UseCase interface, we need a @Qualifer annotation for the original and for the fully decorated UseCase.\n1 2 3 4 5 6 7  @Service // the original UseCase needs a @Qualifier // because Spring must distinguish between multiple implementations @Qualifier(\"plainCreateOrderUseCase\") public class CreateOrderUseCase implements ICreateOrderUseCase {  // ... }   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  // wire the Decorators and the original UseCase together  @Configuration public class AppConfig {   @Bean  @Qualifier(\"decoratedCreateOrderUseCase\")  public ICreateOrderUseCase decoratedCreateOrderUseCase(  @Qualifier(\"plainCreateOrderUseCase\") ICreateOrderUseCase createOrderUseCase) {  LoggingCreateOrderUseCase loggingCreateOrderUseCase =  new LoggingCreateOrderUseCase(createOrderUseCase);  DurationCreateOrderUseCase decoratedUseCase =  new DurationCreateOrderUseCase(loggingCreateOrderUseCase);  return decoratedUseCase;  } }   1 2 3 4 5 6 7 8 9 10 11 12 13  // in order to inject the decorated UseCase, we must use a @Qualifier  @RestController public class Controller {   @Autowired  @Qualifier(\"decoratedCreateOrderUseCase\")  private ICreateOrderUseCase useCase;   public void createOrder() {  useCase.createOrder();  } }   We added Cross-Cutting concerns to the existing CreateOrderUseCase. We comply to the Open-Closed Principle once more! However, the main downside of the described approach is that we have to write specific decorators for every Use-Case. This violates the DRY Principle. One way to fix this is to find a common interface for all Use-Cases. Then you can write one decorator and cover all Use-Cases at once. At the beginning we introduced the Command-Query Separation. It is possible to classify all methods into commands and queries. For commands, a unifying interface would look like this:\n1 2 3 4  public interface CommandHandlerTCommand {   void handle(TCommand command); }   If your Use-Cases implement the CommandHandler interface, you can write one Logging Decorator and it will cover all CommandHandlers aka Use-Cases. You can find an in-depth elaboration for the Command Handler Pattern and even for the Query Handler Pattern in Steven van Deursen’s blog.\nFinal Thoughts Phew! That was a long refactoring journey but I truly believe, every step was very valuable and showed how to combine SOLID principles and Design Patterns in order to write clean and extensible code. I hope you got inspired and you use the new insights in your own projects.\nFinally, I want to mention that this article was heavily inspired by the book Dependency Injection Principles, Practices, and Patterns . Basically it is a rewrite of chapter 10 and ports the C# examples to Java with Spring Boot.\nOne more thing Please don’t be dogmatic about the given advice. Use your own judgement when to apply predefined principles and patterns! Don’t be the guy who rewrites the whole codebase with Decorator- and Composite patterns tomorrow. Every situation is different, every scenario requires its own assessment. Never forget:\n It depends. - Kent Beck\n DDD and SOLID make sense for medium to large projects. A simple CRUD application won’t benefit from over-engineered abstractions. They will be even counter-productive and introduce accidental complexity.\nReferences   Dependency Injection Principles, Practices, and Patterns \n  Command Handler Pattern\n  Query Handler Pattern\n  ","wordCount":"2334","inLanguage":"en","datePublished":"2023-07-19T08:00:00+01:00","dateModified":"2023-07-19T08:00:00+01:00","author":{"@type":"Person","name":"Daniel Gerlach"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://gerlacdt.github.io/blog/posts/ddd-solid/"},"publisher":{"@type":"Organization","name":"Daniel's programming rants","logo":{"@type":"ImageObject","url":"https://gerlacdt.github.io/blog/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://gerlacdt.github.io/blog accesskey=h title="Home (Alt + H)">Home</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://gerlacdt.github.io/blog/posts/ title=posts><span>posts</span></a></li><li><a href=https://gerlacdt.github.io/blog/tags/ title=tags><span>tags</span></a></li><li><a href=https://gerlacdt.github.io/blog/about title=about><span>about</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://gerlacdt.github.io/blog>Home</a>&nbsp;»&nbsp;<a href=https://gerlacdt.github.io/blog/posts/>Posts</a></div><h1 class=post-title>DDD and SOLID: A refactoring story</h1><div class=post-meta><span title="2023-07-19 08:00:00 +0100 +0100">July 19, 2023</span>&nbsp;·&nbsp;11 min&nbsp;·&nbsp;Daniel Gerlach</div></header><div class=post-content><h2 id=tldr>TL;DR<a hidden class=anchor aria-hidden=true href=#tldr>#</a></h2><ol><li>Command-Query Separation</li><li>Extract Use Cases (Clean/Hexagonal Architecture)</li><li>Domain Events (with Eventhandlers and Composite Pattern)</li><li>Cross-Cutting Concerns (with Decorator Pattern)</li></ol><p>Many backend applications end up as a <em>big ball of mud</em> where small changes
ripple through the whole codebase. The root causes are <em>high coupling</em> and <em>low
cohesion</em>. The best remedies against those are
<a href=https://martinfowler.com/bliki/DomainDrivenDesign.html>Domain Driven Design</a>
(DDD) and the <a href=https://en.wikipedia.org/wiki/SOLID>SOLID</a> principles which are
well-known, but often wrongly applied.</p><p>Even if teams think they practice DDD, they mostly use
<a href=https://martinfowler.com/eaaCatalog/transactionScript.html>transaction scripts</a>
with an
<a href=https://martinfowler.com/bliki/AnemicDomainModel.html>anemic domain model</a>.
Services containing these transaction scripts evolve into god classes with
thousand lines of code and dozen of dependencies. Such code is hard to test,
hard to maintain and hard to comprehend. Does the following code snippet look
familiar to you?</p><p align=left><img src=/img/codinghorror.png alt=codinghorror class=medium-zoom-image width=70></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// BAD CODE!!!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrderService</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> OrderRepository orderRepository<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> CardService cardService<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> DiscountCalculatorService discountCalculatorService<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> CustomerService customerService<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> EmailService emailService<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> ShippingService shippingService<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// many more dependencies...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> Order <span style=color:#a6e22e>createOrder</span><span style=color:#f92672>(</span>params<span style=color:#f92672>:</span> OrderParms<span style=color:#f92672>)</span> <span style=color:#f92672>{}</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> Order <span style=color:#a6e22e>getOrder</span><span style=color:#f92672>(</span>orderId<span style=color:#f92672>:</span> UUID<span style=color:#f92672>)</span> <span style=color:#f92672>{}</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>Order<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>filterOrdersByDate</span><span style=color:#f92672>(</span>id<span style=color:#f92672>:</span> UserId<span style=color:#f92672>,</span> range<span style=color:#f92672>:</span> DateRange<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>updateOrder</span><span style=color:#f92672>(</span>id<span style=color:#f92672>:</span> OrderId<span style=color:#f92672>)</span> <span style=color:#f92672>{}</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addToCard</span><span style=color:#f92672>(</span>id<span style=color:#f92672>:</span> OrderId<span style=color:#f92672>)</span> <span style=color:#f92672>{}</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addDiscount</span><span style=color:#f92672>(</span>id<span style=color:#f92672>:</span> OrderId<span style=color:#f92672>)</span> <span style=color:#f92672>{}</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addDiscountForPremiumCustomer</span><span style=color:#f92672>(</span>id<span style=color:#f92672>:</span> OrderId<span style=color:#f92672>)</span> <span style=color:#f92672>{}</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>shipOrder</span><span style=color:#f92672>(</span>id<span style=color:#f92672>:</span> OrderId<span style=color:#f92672>)</span> <span style=color:#f92672>{}</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> OrderStatus <span style=color:#a6e22e>getOrderStatus</span><span style=color:#f92672>(</span>id<span style=color:#f92672>:</span> OrderId<span style=color:#f92672>)</span> <span style=color:#f92672>{}</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>cancelOrder</span><span style=color:#f92672>(</span>id<span style=color:#f92672>:</span> OrderId<span style=color:#f92672>)</span> <span style=color:#f92672>{}</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>Order<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getCanceledOrders</span><span style=color:#f92672>(</span>id<span style=color:#f92672>:</span> UserId<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// many more methods...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Surrounding all behaviour around one domain object in a single class is an OOP
anti-pattern and leads to unsustainable code. In this article, we&rsquo;ll refactor
the code above into a maintainable and decoupled solution with the help of DDD
and the SOLID principles. Let&rsquo;s first find out what SOLID principles are
violated and why.</p><h4 id=single-responsibility-principle-srp>Single-Responsibility Principle (SRP)<a hidden class=anchor aria-hidden=true href=#single-responsibility-principle-srp>#</a></h4><blockquote><p>A class should only have one reason to change.</p></blockquote><p>The <code>OrderService</code> has many reasons to change. For example, it must be adopted
when there a changes for the discount calculation logic, the shipping logic, the
order creation logic etc.. Worse yet, due to the numerous dependencies the
<code>OrderService</code> suffers from low cohesion which also causes the class to be prone
to unrelated changes.</p><h4 id=open-closed-principle>Open-Closed Principle<a hidden class=anchor aria-hidden=true href=#open-closed-principle>#</a></h4><blockquote><p>A class should be open for extension but closed for modification.</p></blockquote><p>The <code>OrderService</code>&rsquo;s business logic is impossible to adapt without touching the
existing code. This makes changes error-prone and is a violation of the
Open-Closed Principle. I know it&rsquo;s hard to imagine how to change behaviour
without touching the code but we&rsquo;ll see later what is meant by that and how to
resolve the problem.</p><h4 id=interface-segregation-principle>Interface-Segregation Principle<a hidden class=anchor aria-hidden=true href=#interface-segregation-principle>#</a></h4><blockquote><p>Clients should not be forced to depend upon interfaces that they do not use.</p></blockquote><p>A consumer of <code>OrderService</code> is overwhelmed by all the methods provided. If a
consumer only wants to use a single method like <code>createOrder()</code>, he must depend
on the complete <code>OrderService</code> interface. Such big interfaces lead to testing
nightmares because in order to create a viable fake, one must implement all
methods even if only one is needed.</p><h4 id=cohesion-and-coupling>Cohesion and Coupling<a hidden class=anchor aria-hidden=true href=#cohesion-and-coupling>#</a></h4><p>The SOLID violations above lead to low cohesion and high coupling. As a result,
simple changes will ripple through the whole codebase and are also error-prone
because we have to modify and touch existing code. This leads to high
maintenance effort. In the next paragraphs, we refactor the <code>OrderService</code>
step-by-step and fix the above issues.</p><h2 id=refactorings>Refactorings<a hidden class=anchor aria-hidden=true href=#refactorings>#</a></h2><h3 id=command-query-separation>Command-Query Separation<a hidden class=anchor aria-hidden=true href=#command-query-separation>#</a></h3><p>Collecting all functionality around one domain class is bad practice. In order
to improve and slim down the big <code>OrderService</code>, we will split the functionality
into commands and queries. The
<a href=https://martinfowler.com/bliki/CommandQuerySeparation.html>Command-Query Separation Principle</a>
from Bertrand Meyer classifies functions into two types:</p><ul><li><p>A command performs side-effects but does not return a value.</p></li><li><p>A query returns a value but has no side-effects.</p></li></ul><p>The principle helps to write <em>intention-revealing interfaces</em> since readers will
be able to detect the type of a function by just looking at its declaration.
Thus the code is easier to understand. Don&rsquo;t confuse it with the similar
sounding architecture pattern
<a href=https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs>CQRS</a>.</p><p>The restructured <code>OrderService</code> will be split up into two classes:</p><p align=center><img src=/img/command-query-separation.png alt=command-query-separation class=medium-zoom-image width=800></p><p>The god class is stripped down to half its size but it still violates the
Single-Responsibility and Interface-Segregation Principle. Both classes,
<code>OrderCommandService</code> and <code>OrderQueryService</code>, need to be changed because of
multiple reasons and a consumer would still depend on methods which are
potentially not needed.</p><h2 id=extract-use-cases>Extract Use Cases<a hidden class=anchor aria-hidden=true href=#extract-use-cases>#</a></h2><p>To fix the SRP and ISP violations, we extract every single method of the
<code>OrderCommandService</code> and <code>OrderQueryService</code> into its own Use-Case interface.
Use-Cases are a concept from
<a href=https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html>Clean-</a>
and <a href=https://reflectoring.io/spring-hexagonal/>Hexagonal Architecture</a>. Maybe
it sounds over-engineered but for an ever-growing enterprise application it will
soon pay off. The new consistent structure makes it obvious for developers where
to add new functionality, keeps the code extensible and testable, and prevents
god classes.</p><p align=center><img src=/img/use-cases.png alt=use-cases class=medium-zoom-image width=800></p><h2 id=domain-events>Domain Events<a hidden class=anchor aria-hidden=true href=#domain-events>#</a></h2><p>The Use-Case classes became smaller and more structured now, but sometimes even
a single Use-Case can grow too big, especially when there are a lot of related
side-effects involved:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CreateOrderUseCase</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> Order <span style=color:#a6e22e>createOrder</span><span style=color:#f92672>(</span>params<span style=color:#f92672>:</span> OrderParams<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// register order
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// charge customer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// send confirmation email
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// notify warehouse
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// more logic and side-effects ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>A great way to extract such side-effects is to publish <em>DomainEvents</em> which are
processed by <em>EventHandlers</em>. With a generic Interface <code>EventHandler&lt;TEvent></code>,
it is possible to register multiple EventHandlers for a single DomainEvent,
whereby each handler has its own responsibility. For example:</p><ul><li>register order in system</li><li>charge customer account</li><li>send a confirmation email</li><li>notify warehouse to prepare order for shipping</li></ul><p>By moving the side-effect logic into corresponding EventHandlers, the size of
the <code>CreateOrderUseCase</code> class will be reduced drastically. Additionally,
testability also improves because EventHandlers can be tested in isolation.</p><p>The <code>CreatedOrderUseCase</code> will depend on the <code>EventHandler&lt;CreatedOrderEvent></code>
interface. At runtime the <code>CompositeOrderCreatedEventHandler</code> will be injected
which calls all EventHandlers for the <code>OrderCreatedEvent</code>. The class diagram:</p><p align=center><img src=/img/domain_event_hierachy.png alt=domain_event_hierachy class=medium-zoom-image width=800></p><p>The Use-Case logic does not look like a <em>Transaction Script</em> any longer and
feels like clean OOP:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// the generic interface
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>EventHandler</span><span style=color:#f92672>&lt;</span>TEvent<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>handle</span><span style=color:#f92672>(</span>TEvent event<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Service</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CreateOrderUseCase</span> <span style=color:#66d9ef>implements</span> ICreateOrderUseCase <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// an &#34;composite&#34; EventHandler which executes multiple EventHandlers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> EventHandler<span style=color:#f92672>&lt;</span>OrderCreatedEvent<span style=color:#f92672>&gt;</span> eventHandler<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> OrderRepository orderRepository<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Spring needs a @Qualifier in order to locate the right EventHandler
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// because there are multiple EventHandler implementations for the same interface
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>CreateOrderUseCase</span><span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>@Qualifier</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;compositeOrderCreatedEventHandler&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          EventHandler<span style=color:#f92672>&lt;</span>OrderCreatedEvent<span style=color:#f92672>&gt;</span> eventHandler<span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>          OrderRepository orderRepository<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>eventHandler</span> <span style=color:#f92672>=</span> eventHandler<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>orderRepository</span> <span style=color:#f92672>=</span> orderRepository<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> Order <span style=color:#a6e22e>createOrder</span><span style=color:#f92672>(</span>OrderParams params<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    String id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;randomOrderId&#34;</span><span style=color:#f92672>;</span>  <span style=color:#75715e>// simplified for the example
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    Order order <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Order<span style=color:#f92672>(</span>id<span style=color:#f92672>,</span> params<span style=color:#f92672>.</span><span style=color:#a6e22e>getItemId</span><span style=color:#f92672>(),</span> params<span style=color:#f92672>.</span><span style=color:#a6e22e>getAmount</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    orderRepository<span style=color:#f92672>.</span><span style=color:#a6e22e>save</span><span style=color:#f92672>(</span>order<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// side-effects are hidden inside the EventHandler
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// all side-effects are processed with one call!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    eventHandler<span style=color:#f92672>.</span><span style=color:#a6e22e>handle</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> OrderCreatedEvent<span style=color:#f92672>(</span>order<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> order<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>The grouping of all EventHandlers for one specific DomainEvent is done via the
<a href=https://en.wikipedia.org/wiki/Composite_pattern><em>Composite Pattern</em></a>:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// single EventHandler
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ConfirmEmailHandler</span> <span style=color:#66d9ef>implements</span> EventHandler<span style=color:#f92672>&lt;</span>OrderCreatedEvent<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>handle</span><span style=color:#f92672>(</span>OrderCreatedEvent orderCreatedEvent<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;[EVENT] sent confirmation email to customer&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// single EventHandler
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NotifyWarehouseHandler</span> <span style=color:#66d9ef>implements</span> EventHandler<span style=color:#f92672>&lt;</span>OrderCreatedEvent<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>handle</span><span style=color:#f92672>(</span>OrderCreatedEvent orderCreatedEvent<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;[EVENT] notify warehouse of new order&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// single EventHandler
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ChargeCustomerHandler</span> <span style=color:#66d9ef>implements</span> EventHandler<span style=color:#f92672>&lt;</span>OrderCreatedEvent<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> PaymentGateway paymentGateway<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>ChargeCustomerHandler</span><span style=color:#f92672>(</span>PaymentGateway paymentGateway<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>paymentGateway</span> <span style=color:#f92672>=</span> paymentGateway<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>handle</span><span style=color:#f92672>(</span>OrderCreatedEvent orderCreatedEvent<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>paymentGateway</span><span style=color:#f92672>.</span><span style=color:#a6e22e>chargeCustomer</span><span style=color:#f92672>(</span>orderCreatedEvent<span style=color:#f92672>.</span><span style=color:#a6e22e>getOrder</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// composite EventHandler includes all EventHandlers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Service</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Qualifier</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;compositeOrderCreatedEventHandler&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CompositeOrderCreatedEventHandler</span> <span style=color:#66d9ef>implements</span> EventHandler<span style=color:#f92672>&lt;</span>OrderCreatedEvent<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// all available event handlers without a @Qualifier will be injected automatically
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> List<span style=color:#f92672>&lt;</span>EventHandler<span style=color:#f92672>&lt;</span>OrderCreatedEvent<span style=color:#f92672>&gt;&gt;</span> eventHandlers<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>CompositeOrderCreatedEventHandler</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>EventHandler<span style=color:#f92672>&lt;</span>OrderCreatedEvent<span style=color:#f92672>&gt;&gt;</span> eventHandlers<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>eventHandlers</span> <span style=color:#f92672>=</span> eventHandlers<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>handle</span><span style=color:#f92672>(</span>OrderCreatedEvent orderCreatedEvent<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// call all registered event handler for OrderCreatedEvent
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>EventHandler<span style=color:#f92672>&lt;</span>OrderCreatedEvent<span style=color:#f92672>&gt;</span> handler <span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>eventHandlers</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      handler<span style=color:#f92672>.</span><span style=color:#a6e22e>handle</span><span style=color:#f92672>(</span>orderCreatedEvent<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>The restructuring enables us to add new functionality without modifying existing
code. Therefore we comply with the <em>Open-Closed principle</em>! If we want to add a
new side-effect, we only have to add a new implementation of
<code>EventHandler&lt;OrderCreatedEvent></code>. It is not necessary to touch the original
<code>CreateOrderUseCase</code> class anymore.</p><p>Some intrigued readers may wonder how to test this setup.
<a href=https://spring.io/projects/spring-boot>Spring Boot</a> offers an easy way to
replace the EventHandlers with Test Doubles:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@TestConfiguration</span> <span style=color:#75715e>// this will take precedence in tests
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FakeConfig</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// example how to manually setup the EventHandlers for tests
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Qualifier</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;compositeOrderCreatedEventHandler&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> EventHandler<span style=color:#f92672>&lt;</span>OrderCreatedEvent<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>eventHandler</span><span style=color:#f92672>(</span>PaymentGateway paymentGateway<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    var warehouseHandler <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> NotifyWarehouseHandler<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    var chargeCustomerHandler <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ChargeCustomerHandler<span style=color:#f92672>(</span>paymentGateway<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>EventHandler<span style=color:#f92672>&lt;</span>OrderCreatedEvent<span style=color:#f92672>&gt;&gt;</span> handlers <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>        List<span style=color:#f92672>.</span><span style=color:#a6e22e>of</span><span style=color:#f92672>(</span>warehouseHandler<span style=color:#f92672>,</span> chargeCustomerHandler<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    var compositeHandler <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CompositeOrderCreatedEventHandler<span style=color:#f92672>(</span>handlers<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> compositeHandler<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@SpringBootTest</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Import</span><span style=color:#f92672>(</span>FakeConfig<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>)</span> <span style=color:#75715e>// replace dependencies with test doubles
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CreateOrderUseCaseFakeTest</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Autowired</span> CreateOrderUseCase sut<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>createOrderTest_validInput_ok</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=cross-cutting-concerns>Cross-Cutting Concerns<a hidden class=anchor aria-hidden=true href=#cross-cutting-concerns>#</a></h2><p>We are able to add new functionality without touching existing code but we are
restricted to prescribed <em>Domain Events</em>. What if we want to add general
functionality like <em>Cross Cutting Concerns</em>:</p><ul><li>Logging</li><li>Transactions</li><li>Metrics (e.g. duration profiling)</li></ul><p>The naive approach would be to add the new code into the Use-Case class itself
but we already know that this violates the Open-Closed Principle. Maybe there is
another approach? And yes there is. We can utilize the
<a href=https://en.wikipedia.org/wiki/Decorator_pattern><em>Decorator Pattern</em></a> to enrich
the existing Use-Case with logging, transactional or profiling behaviour. The
following example shows decorators wrapping the <code>CreateOrderUseCase</code> with
logging and profiling:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// Duration Decorator
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Measures the duration of the UseCase method
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DurationCreateOrderUseCase</span> <span style=color:#66d9ef>implements</span> ICreateOrderUseCase <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Logger log <span style=color:#f92672>=</span> LoggerFactory<span style=color:#f92672>.</span><span style=color:#a6e22e>getLogger</span><span style=color:#f92672>(</span>DurationCreateOrderUseCase<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// the original UseCase
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>private</span> ICreateOrderUseCase inner<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>DurationCreateOrderUseCase</span><span style=color:#f92672>(</span>ICreateOrderUseCase inner<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>inner</span> <span style=color:#f92672>=</span> inner<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> Order <span style=color:#a6e22e>createOrder</span><span style=color:#f92672>(</span>OrderParams params<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    var start <span style=color:#f92672>=</span> System<span style=color:#f92672>.</span><span style=color:#a6e22e>nanoTime</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// execute original logic
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    var order <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>inner</span><span style=color:#f92672>.</span><span style=color:#a6e22e>createOrder</span><span style=color:#f92672>(</span>params<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    var end <span style=color:#f92672>=</span> System<span style=color:#f92672>.</span><span style=color:#a6e22e>nanoTime</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    var durationMicros <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>end <span style=color:#f92672>-</span> start<span style=color:#f92672>)</span> <span style=color:#f92672>/</span> 1000<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;[DURATION] createOrder() =&gt; {} micro seconds&#34;</span><span style=color:#f92672>,</span> durationMicros<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> order<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// Logging Decorator
</span></span></span><span style=display:flex><span><span style=color:#75715e>// logs the input parameter of the UseCase method
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LoggingCreateOrderUseCase</span> <span style=color:#66d9ef>implements</span> ICreateOrderUseCase <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Logger log <span style=color:#f92672>=</span> LoggerFactory<span style=color:#f92672>.</span><span style=color:#a6e22e>getLogger</span><span style=color:#f92672>(</span>LoggingCreateOrderUseCase<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> ICreateOrderUseCase inner<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>LoggingCreateOrderUseCase</span><span style=color:#f92672>(</span>ICreateOrderUseCase inner<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>inner</span> <span style=color:#f92672>=</span> inner<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> Order <span style=color:#a6e22e>createOrder</span><span style=color:#f92672>(</span>OrderParams params<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// log params
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    log<span style=color:#f92672>.</span><span style=color:#a6e22e>info</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;[LoggingDecorator] function params: {}&#34;</span><span style=color:#f92672>,</span> params<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// executes original logic
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> inner<span style=color:#f92672>.</span><span style=color:#a6e22e>createOrder</span><span style=color:#f92672>(</span>params<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>The next step is to make the decorated UseCase available as a Spring Bean.
Because we have multiple implementations of the UseCase interface, we need a
<code>@Qualifer</code> annotation for the original and for the fully decorated UseCase.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Service</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// the original UseCase needs a @Qualifier
</span></span></span><span style=display:flex><span><span style=color:#75715e>// because Spring must distinguish between multiple implementations
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>@Qualifier</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;plainCreateOrderUseCase&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CreateOrderUseCase</span> <span style=color:#66d9ef>implements</span> ICreateOrderUseCase <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// wire the Decorators and the original UseCase together
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AppConfig</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Qualifier</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;decoratedCreateOrderUseCase&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> ICreateOrderUseCase <span style=color:#a6e22e>decoratedCreateOrderUseCase</span><span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>@Qualifier</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;plainCreateOrderUseCase&#34;</span><span style=color:#f92672>)</span> ICreateOrderUseCase createOrderUseCase<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    LoggingCreateOrderUseCase loggingCreateOrderUseCase <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>new</span> LoggingCreateOrderUseCase<span style=color:#f92672>(</span>createOrderUseCase<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    DurationCreateOrderUseCase decoratedUseCase <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>new</span> DurationCreateOrderUseCase<span style=color:#f92672>(</span>loggingCreateOrderUseCase<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> decoratedUseCase<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// in order to inject the decorated UseCase, we must use a @Qualifier
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Controller</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Qualifier</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;decoratedCreateOrderUseCase&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> ICreateOrderUseCase useCase<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>createOrder</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    useCase<span style=color:#f92672>.</span><span style=color:#a6e22e>createOrder</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>We added Cross-Cutting concerns to the existing <code>CreateOrderUseCase</code>. We comply
to the Open-Closed Principle once more! However, the main downside of the
described approach is that we have to write specific decorators for every
Use-Case. This violates the
<a href=https://en.wikipedia.org/wiki/Don%27t_repeat_yourself>DRY Principle</a>. One way
to fix this is to find a common interface for all Use-Cases. Then you can write
one decorator and cover all Use-Cases at once. At the beginning we introduced
the <em>Command-Query Separation</em>. It is possible to classify all methods into
commands and queries. For commands, a unifying interface would look like this:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>CommandHandler</span><span style=color:#f92672>&lt;</span>TCommand<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>handle</span><span style=color:#f92672>(</span>TCommand command<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></td></tr></table></div></div><p>If your Use-Cases implement the <code>CommandHandler&lt;TCommand></code> interface, you can
write one Logging Decorator and it will cover all CommandHandlers aka Use-Cases.
You can find an in-depth elaboration for the
<a href=https://blogs.cuttingedge.it/steven/posts/2011/meanwhile-on-the-command-side-of-my-architecture/><em>Command Handler Pattern</em></a>
and even for the
<a href=https://blogs.cuttingedge.it/steven/posts/2011/meanwhile-on-the-query-side-of-my-architecture/><em>Query Handler Pattern</em></a>
in Steven van Deursen&rsquo;s blog.</p><h1 id=final-thoughts>Final Thoughts<a hidden class=anchor aria-hidden=true href=#final-thoughts>#</a></h1><p>Phew! That was a long refactoring journey but I truly believe, every step was
very valuable and showed how to combine SOLID principles and Design Patterns in
order to write clean and extensible code. I hope you got inspired and you use
the new insights in your own projects.</p><p>Finally, I want to mention that this article was heavily inspired by the book
<a href=https://www.manning.com/books/dependency-injection-principles-practices-patterns>Dependency Injection Principles, Practices, and Patterns </a>.
Basically it is a rewrite of chapter 10 and ports the C# examples to Java with
Spring Boot.</p><h4 id=one-more-thing>One more thing<a hidden class=anchor aria-hidden=true href=#one-more-thing>#</a></h4><p>Please don&rsquo;t be dogmatic about the given advice. Use your own judgement when to
apply predefined principles and patterns! Don&rsquo;t be the guy who rewrites the
whole codebase with Decorator- and Composite patterns tomorrow. Every situation
is different, every scenario requires its own assessment. Never forget:</p><blockquote><p>It depends. - Kent Beck</p></blockquote><p>DDD and SOLID make sense for medium to large projects. A simple CRUD application
won&rsquo;t benefit from over-engineered abstractions. They will be even
counter-productive and introduce accidental complexity.</p><h1 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h1><ul><li><p><a href=https://www.manning.com/books/dependency-injection-principles-practices-patterns>Dependency Injection Principles, Practices, and Patterns</a></p></li><li><p><a href=https://blogs.cuttingedge.it/steven/posts/2011/meanwhile-on-the-command-side-of-my-architecture/>Command Handler Pattern</a></p></li><li><p><a href=https://blogs.cuttingedge.it/steven/posts/2011/meanwhile-on-the-query-side-of-my-architecture/>Query Handler Pattern</a></p></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://gerlacdt.github.io/blog/tags/programming/>programming</a></li><li><a href=https://gerlacdt.github.io/blog/tags/softwareengineering/>softwareengineering</a></li><li><a href=https://gerlacdt.github.io/blog/tags/ddd/>ddd</a></li><li><a href=https://gerlacdt.github.io/blog/tags/solid/>solid</a></li></ul><nav class=paginav><a class=prev href=https://gerlacdt.github.io/blog/posts/production-readiness-checklist/><span class=title>« Prev Page</span><br><span>Production Readiness Checklist</span></a>
<a class=next href=https://gerlacdt.github.io/blog/posts/habits/><span class=title>Next Page »</span><br><span>Top 10 Practices Of Effective Software Engineers</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share DDD and SOLID: A refactoring story on twitter" href="https://twitter.com/intent/tweet/?text=DDD%20and%20SOLID%3a%20A%20refactoring%20story&url=https%3a%2f%2fgerlacdt.github.io%2fblog%2fposts%2fddd-solid%2f&hashtags=programming%2csoftwareengineering%2cddd%2csolid"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share DDD and SOLID: A refactoring story on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fgerlacdt.github.io%2fblog%2fposts%2fddd-solid%2f&title=DDD%20and%20SOLID%3a%20A%20refactoring%20story&summary=DDD%20and%20SOLID%3a%20A%20refactoring%20story&source=https%3a%2f%2fgerlacdt.github.io%2fblog%2fposts%2fddd-solid%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share DDD and SOLID: A refactoring story on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fgerlacdt.github.io%2fblog%2fposts%2fddd-solid%2f&title=DDD%20and%20SOLID%3a%20A%20refactoring%20story"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share DDD and SOLID: A refactoring story on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fgerlacdt.github.io%2fblog%2fposts%2fddd-solid%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share DDD and SOLID: A refactoring story on whatsapp" href="https://api.whatsapp.com/send?text=DDD%20and%20SOLID%3a%20A%20refactoring%20story%20-%20https%3a%2f%2fgerlacdt.github.io%2fblog%2fposts%2fddd-solid%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share DDD and SOLID: A refactoring story on telegram" href="https://telegram.me/share/url?text=DDD%20and%20SOLID%3a%20A%20refactoring%20story&url=https%3a%2f%2fgerlacdt.github.io%2fblog%2fposts%2fddd-solid%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://gerlacdt.github.io/blog>Daniel's programming rants</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>